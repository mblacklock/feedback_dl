{% load feedback_filters %}
<div class="row g-0 grade-bands-grid">
    {% for main_grade, band_list in grouped_bands.items %}
    <div class="col">
        <div class="card h-100 d-flex flex-column {% if not forloop.first %}border-start-0{% endif %} rounded-0 {% if forloop.first %}rounded-start{% endif %} {% if forloop.last %}rounded-end{% endif %}">
            <div class="card-header {% if main_grade == '1st' %}{{ header_bg_1st|default:'bg-success-subtle bg-gradient' }}{% elif main_grade == 'Fail' %}{{ header_bg_fail|default:'bg-danger-subtle bg-gradient' }}{% else %}bg-light{% endif %} py-1 px-2 {% if not forloop.first %}border-start-0{% endif %}">
                <small class="fw-bold">{{ main_grade }}</small>
            </div>
            <div class="card-body p-2 d-flex flex-column">
                <div class="mb-2">
                    <div class="row g-1 text-center small">
                        {% for band in band_list %}
                        <div class="col d-flex flex-column">
                            <div class="fw-semibold text-muted" style="min-height: 2.5rem;">{{ band.grade }}</div>
                            <div class="badge {{ badge_class|default:'bg-secondary-subtle text-black' }} w-100">{{ band.marks }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% if show_textarea %}
                <textarea class="form-control form-control-sm grade-description mt-auto" 
                          data-grade="{{ main_grade }}" 
                          placeholder="Description for {{ main_grade }}..." 
                          rows="3">{{ descriptions|get_item:main_grade|default:'' }}</textarea>
                {% else %}
                    {% if main_grade in descriptions %}
                    <p class="small mb-0 text-muted mt-auto">
                        {{ descriptions|get_item:main_grade }}
                    </p>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
