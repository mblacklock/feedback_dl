{% load feedback_filters %}
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-0 grade-bands-grid">
    {% for main_grade, band_list in grouped_bands.items %}
        <div class="col">
            <div class="card h-100 d-flex flex-column {% if not forloop.first %}border-start-0{% endif %} rounded-0 {% if forloop.first %}rounded-start{% endif %} {% if forloop.last %}rounded-end{% endif %}">
                <div class="card-body {% if main_grade == '1st' %}{{ header_bg_1st|default:'bg-success-subtle bg-gradient' }}{% elif main_grade == 'Fail' %}{{ header_bg_fail|default:'bg-danger-subtle bg-gradient' }}{% else %}bg-light{% endif %} p-2 d-flex flex-column">
                {% if show_textarea %}
                <textarea class="form-control form-control-sm grade-description mb-2" 
                          data-grade="{{ main_grade }}" 
                          placeholder="Description for {{ main_grade }}..." 
                          rows="3">{{ descriptions|get_item:main_grade|default:'' }}</textarea>
                {% else %}
                    {% if main_grade in descriptions %}
                    <p class="small mb-2 text-muted">
                        {{ descriptions|get_item:main_grade }}
                    </p>
                    {% endif %}
                {% endif %}
                <div class="mt-auto pt-2 border-top">
                    <div class="row g-1 text-center small">
                        {% for band in band_list %}
                        <div class="col d-flex flex-column">
                            <div class="fw-semibold text-muted" style="min-height: 2.5rem;">{{ band.grade }}</div>
                            <div class="badge {{ badge_class|default:'bg-secondary-subtle text-black' }} w-100">{{ band.marks }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
